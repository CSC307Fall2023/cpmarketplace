(()=>{var e={};e.id=7413,e.ids=[7413],e.modules={72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},55403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},94749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},6113:e=>{"use strict";e.exports=require("crypto")},9523:e=>{"use strict";e.exports=require("dns")},82361:e=>{"use strict";e.exports=require("events")},57147:e=>{"use strict";e.exports=require("fs")},13685:e=>{"use strict";e.exports=require("http")},85158:e=>{"use strict";e.exports=require("http2")},95687:e=>{"use strict";e.exports=require("https")},41808:e=>{"use strict";e.exports=require("net")},22037:e=>{"use strict";e.exports=require("os")},71017:e=>{"use strict";e.exports=require("path")},77282:e=>{"use strict";e.exports=require("process")},85477:e=>{"use strict";e.exports=require("punycode")},12781:e=>{"use strict";e.exports=require("stream")},24404:e=>{"use strict";e.exports=require("tls")},57310:e=>{"use strict";e.exports=require("url")},73837:e=>{"use strict";e.exports=require("util")},59796:e=>{"use strict";e.exports=require("zlib")},70522:(e,r,t)=>{"use strict";t.r(r),t.d(r,{GlobalError:()=>a.a,__next_app__:()=>p,originalPathname:()=>d,pages:()=>u,routeModule:()=>h,tree:()=>c});var s=t(67096),i=t(16132),n=t(37284),a=t.n(n),o=t(32564),l={};for(let e in o)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>o[e]);t.d(r,l);let c=["",{children:["setup",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(t.bind(t,34500)),"/Users/jlau/Code-2023/cpmarketplace/src/app/setup/page.js"]}]},{metadata:{icon:[async e=>(await Promise.resolve().then(t.bind(t,73881))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]},{layout:[()=>Promise.resolve().then(t.bind(t,96109)),"/Users/jlau/Code-2023/cpmarketplace/src/app/layout.js"],"not-found":[()=>Promise.resolve().then(t.t.bind(t,9291,23)),"next/dist/client/components/not-found-error"],metadata:{icon:[async e=>(await Promise.resolve().then(t.bind(t,73881))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}],u=["/Users/jlau/Code-2023/cpmarketplace/src/app/setup/page.js"],d="/setup/page",p={require:t,loadChunk:()=>Promise.resolve()},h=new s.AppPageRouteModule({definition:{kind:i.x.APP_PAGE,page:"/setup/page",pathname:"/setup",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},73098:(e,r,t)=>{Promise.resolve().then(t.bind(t,44187))},44187:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>Profile});var s=t(30784),i=t(9885),n=t(81932),a=t.n(n),o=t(16614),l=t.n(o),c=t(21971),u=t.n(c),d=t(33987),p=t.n(d),h=t(48060),x=t.n(h),m=t(52694),g=t.n(m),j=t(95843),b=t.n(j),f=t(92870),v=t.n(f),y=t(62969),P=t.n(y),q=t(42153),_=t.n(q),C=t(16856),k=t.n(C),w=t(95915),I=t.n(w),S=t(29300),D=t(96686),R=t(64622),U=t(57114),N=t(18282),E=t(40140),L=t(96106);function Profile(){let[e,r]=(0,i.useState)({}),[t,n]=(0,i.useState)(),[o,c]=(0,i.useState)(!1),[d,h]=(0,i.useState)(!1),[m,j]=(0,i.useState)([]),[f,y]=(0,i.useState)([]),[q,C]=(0,i.useState)(!1),[w,$]=(0,i.useState)(!1),{getUser:A,isLoggedIn:F}=(0,N.useAuth)(),G=(0,U.useRouter)(),z=(0,i.useCallback)(e=>{let r=e[0],t=URL.createObjectURL(r);j([r,t]),C(!1)},[]),V=(0,i.useCallback)(e=>{let r=e[0],t=URL.createObjectURL(r);y([r,t]),$(!1)},[]),{getRootProps:B,getInputProps:M}=(0,R.useDropzone)({onDrop:z,maxFiles:1,accept:{"image/*":[".jpeg",".jpg",".png"]}}),{getRootProps:T,getInputProps:H}=(0,R.useDropzone)({onDrop:V,maxFiles:1,accept:{"image/*":[".jpeg",".jpg",".png"]}}),handleProfileImageDialogClose=()=>{C(!1)},handleHeroDialogClose=()=>{$(!1)},resendVerificationEmail=async()=>{let e=A();await (0,E.w$)(e).catch(e=>{console.error(e),n(e.message)})};async function handleSetupSubmit(t){t.preventDefault();let s=new FormData(t.currentTarget),i=s.get("name"),a=s.get("phoneNumber"),o=s.get("location"),l=A(),c=l.uid;if(!t.currentTarget.reportValidity())return n("Keep name and location under 64 characters, and phone number under 16 characters."),!1;if(a&&!a.match(/^(\+\d{1,2}\s?)?1?\-?\.?\s?\(?\d{3}\)?[\s.-]?\d{3}[\s.-]?\d{4}$/))return n(),r({...e,phoneNumber:{error:!0,message:"Your phone number is not formatted correctly."}}),!1;let u="",d="";if(0!=m.length)try{u=await (0,L.Ix)(c,m[0])}catch(e){return console.error(e),n(e.message),!1}if(0!=f.length)try{d=await (0,L.Ix)(c,f[0])}catch(e){return console.error(e),n(e.message),!1}return await (0,L.Nq)(c,{name:i,phoneNumber:a,location:o,profileImage:u,heroImage:d}).then(()=>{G.push(`/profile/${c}`)}).catch(e=>{console.error(e),n(e.message)}),!1}return(0,i.useEffect)(()=>{if(!F()){G.push("/login");return}let e=A();"calpoly.edu"==e.email.split("@").pop()&&(c(!0),e.emailVerified&&h(!0))},[]),(0,i.useEffect)(()=>{let e=setInterval(()=>{if(F()){A().reload();let r=A();r.emailVerified&&(fetch(`/api/verify/${r.uid}`,{method:"put"}).catch(e=>{console.error(e),n(e.error)}),h(!0),clearInterval(e))}},2e3);return()=>clearInterval(e)},[]),(0,s.jsxs)("div",{style:{height:"100vh"},children:[s.jsx("h1",{style:{textAlign:"center"},children:"Set Up Profile"}),(0,s.jsxs)("form",{onSubmit:handleSetupSubmit,style:{padding:2,display:"flex",flexDirection:"column",alignItems:"center"},children:[o&&!d&&(0,s.jsxs)(s.Fragment,{children:[s.jsx(a(),{severity:"warning",children:"Check your email to verify your student status!"}),s.jsx(l(),{onClick:resendVerificationEmail,children:"Resend email"})]}),o&&d&&s.jsx(a(),{severity:"success",children:"Your email has been verified!"}),t&&s.jsx(a(),{severity:"error",children:t}),(0,s.jsxs)(u(),{container:!0,spacing:2,columnSpacing:8,alignItems:"center",justifyContent:"center",mt:3,children:[(0,s.jsxs)(u(),{item:!0,children:[s.jsx(p(),{align:"center",children:"Profile Picture"}),s.jsx(x(),{onClick:()=>{C(!0)},children:s.jsx(g(),{elevation:3,sx:{width:100,height:100,backgroundImage:`url(${m[1]})`,backgroundSize:"cover",backgroundPosition:"center",position:"relative",borderRadius:"50%"},children:!m[1]&&s.jsx(b(),{alt:"Banner",sx:{width:100,height:100},variant:"circular",children:s.jsx(S.Z,{})})})})]}),(0,s.jsxs)(u(),{item:!0,children:[s.jsx(p(),{align:"center",children:"Banner Image"}),s.jsx(x(),{onClick:()=>{$(!0)},sx:{borderRadius:0},children:s.jsx(g(),{elevation:3,sx:{width:200,height:100,backgroundImage:`url(${f[1]})`,backgroundSize:"cover",backgroundPosition:"center",position:"relative"},children:!f[1]&&s.jsx(b(),{alt:"Banner",sx:{width:200,height:100},variant:"square",children:s.jsx(D.Z,{})})})})]})]}),s.jsx("br",{}),(0,s.jsxs)("div",{style:{width:"30%"},children:[s.jsx(v(),{margin:"dense",variant:"standard",id:"name",name:"name",label:"Name",type:"text",required:!0,fullWidth:!0,inputProps:{maxLength:64}}),s.jsx("br",{}),s.jsx(v(),{margin:"dense",name:"phoneNumber",id:"phoneNumber",label:"Phone Number",type:"tel",fullWidth:!0,error:e.phoneNumber?.error,helperText:e.phoneNumber?.message,variant:"standard",inputProps:{maxLength:16}}),s.jsx("br",{}),s.jsx(v(),{margin:"dense",variant:"standard",id:"location",name:"location",label:"Location",type:"text",fullWidth:!0,inputProps:{maxLength:64}}),s.jsx("br",{}),s.jsx("br",{}),s.jsx(l(),{type:"submit",children:"Complete Setup"})]})]}),(0,s.jsxs)(P(),{open:q,onClose:handleProfileImageDialogClose,"aria-labelledby":"responsive-dialog-title",children:[s.jsx(_(),{id:"responsive-dialog-title",children:"Upload Profile Image"}),s.jsx(k(),{children:(0,s.jsxs)("div",{...B(),style:{border:"1px dashed gray",padding:"20px",cursor:"pointer"},children:[s.jsx("input",{...M()}),s.jsx(p(),{variant:"body1",children:"Drag & drop an image here, or click to select one"})]})}),s.jsx(I(),{children:s.jsx(l(),{autoFocus:!0,onClick:handleProfileImageDialogClose,color:"primary",children:"Cancel"})})]}),(0,s.jsxs)(P(),{open:w,onClose:handleHeroDialogClose,"aria-labelledby":"responsive-dialog-title",children:[s.jsx(_(),{id:"responsive-dialog-title",children:"Upload Banner Image"}),s.jsx(k(),{children:(0,s.jsxs)("div",{...T(),style:{border:"1px dashed gray",padding:"20px",cursor:"pointer"},children:[s.jsx("input",{...H()}),s.jsx(p(),{variant:"body1",children:"Drag & drop an image here, or click to select one"})]})}),s.jsx(I(),{children:s.jsx(l(),{autoFocus:!0,onClick:handleHeroDialogClose,color:"primary",children:"Cancel"})})]})]})}},34500:(e,r,t)=>{"use strict";t.r(r),t.d(r,{$$typeof:()=>a,__esModule:()=>n,default:()=>l});var s=t(95153);let i=(0,s.createProxy)(String.raw`/Users/jlau/Code-2023/cpmarketplace/src/app/setup/page.js`),{__esModule:n,$$typeof:a}=i,o=i.default,l=o}};var r=require("../../webpack-runtime.js");r.C(e);var __webpack_exec__=e=>r(r.s=e),t=r.X(0,[6126,3657,1827,1323,4359,3234,2870,1089,9781,402,2291],()=>__webpack_exec__(70522));module.exports=t})();